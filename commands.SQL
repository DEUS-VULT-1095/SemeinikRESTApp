DROP TABLE IF EXISTS Activation_Token;
DROP TABLE IF EXISTS Session;
DROP TABLE IF EXISTS Person;
DROP TABLE IF EXISTS Family;



CREATE TABLE Family(
                       id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                       family_name VARCHAR (30) NOT NULL,
                       family_identifier VARCHAR (8) UNIQUE NOT NULL
);

CREATE TABLE Person(
                       id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                       email VARCHAR (50) UNIQUE NOT NULL,
                       name VARCHAR (30) NOT NULL,
                       date_of_birth DATE,
                       family_role VARCHAR(30) NOT NULL,
                       password VARCHAR NOT NULL,
                       salt VARCHAR UNIQUE NOT NULL,
                       role VARCHAR (20) NOT NULL,
                       is_activated BOOLEAN DEFAULT FALSE,
                       family_id INT REFERENCES Family (id) ON DELETE SET NULL
);

CREATE TABLE Session(
                        id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                        person_id INT REFERENCES Person(id) ON DELETE CASCADE,
                        refresh_token UUID NOT NULL UNIQUE,
                        expires_in TIMESTAMPTZ NOT NULL,
                        created_at TIMESTAMPTZ NOT NULL
);

CREATE TABLE Activation_Token(
                                 id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                                 token UUID UNIQUE NOT NULL,
                                 created_at TIMESTAMPTZ NOT NULL,
                                 expires_at TIMESTAMPTZ NOT NULL,
                                 person_id INT UNIQUE REFERENCES Person(id) ON DELETE CASCADE
);

